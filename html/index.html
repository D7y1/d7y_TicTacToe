<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <script src="nui://game/ui/jquery.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <link rel="stylesheet" href="./style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>d7y_TicTacToe</title>
</head>

<body>
    <div class="board">
        <div class="header">
            <div class="text">Playing With : <content class="OtherPlayer">D7y</content>
            </div>
            <div class="exit x-mark" onclick="ExitGame()"></div>
        </div>
        <div data-id="1" class="TicTacToe turn-1 player-1 c-1 r-1 d-1"></div>
        <div data-id="2" class="TicTacToe turn-1 player-1 c-2 r-1"></div>
        <div data-id="3" class="TicTacToe turn-1 player-1 c-3 r-1 d-2"></div>
        <div data-id="4" class="TicTacToe turn-1 player-1 c-1 r-2"></div>
        <div data-id="5" class="TicTacToe turn-1 player-1 c-2 r-2 d-1 d-2"></div>
        <div data-id="6" class="TicTacToe turn-1 player-1 c-3 r-2"></div>
        <div data-id="7" class="TicTacToe turn-1 player-1 c-1 r-3 d-2"></div>
        <div data-id="8" class="TicTacToe turn-1 player-1 c-2 r-3"></div>
        <div data-id="9" class="TicTacToe turn-1 player-1 c-3 r-3 d-1"></div>
        <div data-id="10" class="TicTacToe turn-2 player-2 c-1 r-1 d-1"></div>
        <div data-id="11" class="TicTacToe turn-2 player-2 c-2 r-1"></div>
        <div data-id="12" class="TicTacToe turn-2 player-2 c-3 r-1 d-2"></div>
        <div data-id="13" class="TicTacToe turn-2 player-2 c-1 r-2"></div>
        <div data-id="14" class="TicTacToe turn-2 player-2 c-2 r-2 d-1 d-2"></div>
        <div data-id="15" class="TicTacToe turn-2 player-2 c-3 r-2"></div>
        <div data-id="16" class="TicTacToe turn-2 player-2 c-1 r-3 d-2"></div>
        <div data-id="17" class="TicTacToe turn-2 player-2 c-2 r-3"></div>
        <div data-id="18" class="TicTacToe turn-2 player-2 c-3 r-3 d-1"></div>
        <div data-id="19" class="TicTacToe turn-3 player-1 c-1 r-1 d-1"></div>
        <div data-id="20" class="TicTacToe turn-3 player-1 c-2 r-1"></div>
        <div data-id="21" class="TicTacToe turn-3 player-1 c-3 r-1 d-2"></div>
        <div data-id="22" class="TicTacToe turn-3 player-1 c-1 r-2"></div>
        <div data-id="23" class="TicTacToe turn-3 player-1 c-2 r-2 d-1 d-2"></div>
        <div data-id="24" class="TicTacToe turn-3 player-1 c-3 r-2"></div>
        <div data-id="25" class="TicTacToe turn-3 player-1 c-1 r-3 d-2"></div>
        <div data-id="26" class="TicTacToe turn-3 player-1 c-2 r-3"></div>
        <div data-id="27" class="TicTacToe turn-3 player-1 c-3 r-3 d-1"></div>
        <div data-id="28" class="TicTacToe turn-4 player-2 c-1 r-1 d-1"></div>
        <div data-id="29" class="TicTacToe turn-4 player-2 c-2 r-1"></div>
        <div data-id="30" class="TicTacToe turn-4 player-2 c-3 r-1 d-2"></div>
        <div data-id="31" class="TicTacToe turn-4 player-2 c-1 r-2"></div>
        <div data-id="32" class="TicTacToe turn-4 player-2 c-2 r-2 d-1 d-2"></div>
        <div data-id="33" class="TicTacToe turn-4 player-2 c-3 r-2"></div>
        <div data-id="34" class="TicTacToe turn-4 player-2 c-1 r-3 d-2"></div>
        <div data-id="35" class="TicTacToe turn-4 player-2 c-2 r-3"></div>
        <div data-id="36" class="TicTacToe turn-4 player-2 c-3 r-3 d-1"></div>
        <div data-id="37" class="TicTacToe turn-5 player-1 c-1 r-1 d-1"></div>
        <div data-id="38" class="TicTacToe turn-5 player-1 c-2 r-1"></div>
        <div data-id="39" class="TicTacToe turn-5 player-1 c-3 r-1 d-2"></div>
        <div data-id="40" class="TicTacToe turn-5 player-1 c-1 r-2"></div>
        <div data-id="41" class="TicTacToe turn-5 player-1 c-2 r-2 d-1 d-2"></div>
        <div data-id="42" class="TicTacToe turn-5 player-1 c-3 r-2"></div>
        <div data-id="43" class="TicTacToe turn-5 player-1 c-1 r-3 d-2"></div>
        <div data-id="44" class="TicTacToe turn-5 player-1 c-2 r-3"></div>
        <div data-id="45" class="TicTacToe turn-5 player-1 c-3 r-3 d-1"></div>
        <div data-id="46" class="TicTacToe turn-6 player-2 c-1 r-1 d-1"></div>
        <div data-id="47" class="TicTacToe turn-6 player-2 c-2 r-1"></div>
        <div data-id="48" class="TicTacToe turn-6 player-2 c-3 r-1 d-2"></div>
        <div data-id="49" class="TicTacToe turn-6 player-2 c-1 r-2"></div>
        <div data-id="50" class="TicTacToe turn-6 player-2 c-2 r-2 d-1 d-2"></div>
        <div data-id="51" class="TicTacToe turn-6 player-2 c-3 r-2"></div>
        <div data-id="52" class="TicTacToe turn-6 player-2 c-1 r-3 d-2"></div>
        <div data-id="53" class="TicTacToe turn-6 player-2 c-2 r-3"></div>
        <div data-id="54" class="TicTacToe turn-6 player-2 c-3 r-3 d-1"></div>
        <div data-id="55" class="TicTacToe turn-7 player-1 c-1 r-1 d-1"></div>
        <div data-id="56" class="TicTacToe turn-7 player-1 c-2 r-1"></div>
        <div data-id="57" class="TicTacToe turn-7 player-1 c-3 r-1 d-2"></div>
        <div data-id="58" class="TicTacToe turn-7 player-1 c-1 r-2"></div>
        <div data-id="59" class="TicTacToe turn-7 player-1 c-2 r-2 d-1 d-2"></div>
        <div data-id="60" class="TicTacToe turn-7 player-1 c-3 r-2"></div>
        <div data-id="61" class="TicTacToe turn-7 player-1 c-1 r-3 d-2"></div>
        <div data-id="62" class="TicTacToe turn-7 player-1 c-2 r-3"></div>
        <div data-id="63" class="TicTacToe turn-7 player-1 c-3 r-3 d-1"></div>
        <div data-id="64" class="TicTacToe turn-8 player-2 c-1 r-1 d-1"></div>
        <div data-id="65" class="TicTacToe turn-8 player-2 c-2 r-1"></div>
        <div data-id="66" class="TicTacToe turn-8 player-2 c-3 r-1 d-2"></div>
        <div data-id="67" class="TicTacToe turn-8 player-2 c-1 r-2"></div>
        <div data-id="68" class="TicTacToe turn-8 player-2 c-2 r-2 d-1 d-2"></div>
        <div data-id="69" class="TicTacToe turn-8 player-2 c-3 r-2"></div>
        <div data-id="70" class="TicTacToe turn-8 player-2 c-1 r-3 d-2"></div>
        <div data-id="71" class="TicTacToe turn-8 player-2 c-2 r-3"></div>
        <div data-id="72" class="TicTacToe turn-8 player-2 c-3 r-3 d-1"></div>
        <div data-id="73" class="TicTacToe turn-9 player-1 c-1 r-1 d-1"></div>
        <div data-id="74" class="TicTacToe turn-9 player-1 c-2 r-1"></div>
        <div data-id="75" class="TicTacToe turn-9 player-1 c-3 r-1 d-2"></div>
        <div data-id="76" class="TicTacToe turn-9 player-1 c-1 r-2"></div>
        <div data-id="77" class="TicTacToe turn-9 player-1 c-2 r-2 d-1 d-2"></div>
        <div data-id="78" class="TicTacToe turn-9 player-1 c-3 r-2"></div>
        <div data-id="79" class="TicTacToe turn-9 player-1 c-1 r-3 d-2"></div>
        <div data-id="80" class="TicTacToe turn-9 player-1 c-2 r-3"></div>
        <div data-id="81" class="TicTacToe turn-9 player-1 c-3 r-3 d-1"></div>
        <div class="overlay">
            <div class="message"></div>
        </div>
    </div>
    <script>
        $(".board").hide()
        $('.player-1').val("")
        $('.player-2').val("")

        window.addEventListener('message', function (event) {
            var data = event.data
            if (data.Start) {
                resetGame()
                $(".OtherPlayer").text(data.OtherPlayer)
                $(".board").data("game", data.GameID)
                if (data.meinv) {
                    $(".board").addClass("me-x")
                }
                StartGame()
            }
            if (data.Stop) {
                resetGame()
            }
            if (data.CheckPlace) {
                CheckPlaceByCode(data.Pplayer, data.Pplace)
            }
        })

        $(".TicTacToe").click(function () {
            if ($('.board').hasClass("me-turn") && !$(this).hasClass('checked')) {
                $(".board").removeClass("me-turn")
                $(".board").addClass("me-NOT")
                $(this).addClass("checked")
                let place = GetPlace(this)
                $.post('http://d7y_TicTacToe/checked', JSON.stringify({ GameID: $(".board").data("game"), player: $(".board").hasClass("me-x") ? "1" : "2", place: place }));
            } else {

            }
        })

        function StartGame() {
            $(".board").show()
            if ($(".board").hasClass('me-x')) {
                $(".board").addClass("me-turn")
            } else {
                $(".board").addClass("me-NOT")
            }
        }

        function ExitGame() {
            resetGame()
            $.post('http://d7y_TicTacToe/exit', JSON.stringify({ GameID: $(".board").data("game") }));
        }

        function resetGame() {
            $(".checked").removeClass("checked")
            $(".board").removeClass("me-x").removeClass("me-turn").removeClass("me-NOT")
            $(".board").hide()
        }

        function IsPlayer1Win() {
            let method1 = "body .board .TicTacToe.player-1.c-3.checked ~ .TicTacToe.player-1.c-3.checked ~ .TicTacToe.player-1.c-3.checked"
            let method2 = "body .board .TicTacToe.player-1.r-3.checked ~ .TicTacToe.player-1.r-3.checked ~ .TicTacToe.player-1.r-3.checked"
            let method3 = "body .board .TicTacToe.player-1.d-3.checked ~ .TicTacToe.player-1.d-3.checked ~ .TicTacToe.player-1.d-3.checked"
            let method4 = "body .board .TicTacToe.player-1.c-2.checked ~ .TicTacToe.player-1.c-2.checked ~ .TicTacToe.player-1.c-2.checked"
            let method5 = "body .board .TicTacToe.player-1.r-2.checked ~ .TicTacToe.player-1.r-2.checked ~ .TicTacToe.player-1.r-2.checked"
            let method6 = "body .board .TicTacToe.player-1.d-2.checked ~ .TicTacToe.player-1.d-2.checked ~ .TicTacToe.player-1.d-2.checked"
            let method7 = "body .board .TicTacToe.player-1.c-1.checked ~ .TicTacToe.player-1.c-1.checked ~ .TicTacToe.player-1.c-1.checked"
            let method8 = "body .board .TicTacToe.player-1.r-1.checked ~ .TicTacToe.player-1.r-1.checked ~ .TicTacToe.player-1.r-1.checked"
            let method9 = "body .board .TicTacToe.player-1.d-1.checked ~ .TicTacToe.player-1.d-1.checked ~ .TicTacToe.player-1.d-1.checked"
            return $(method1).length >= 1 || $(method2).length >= 1 || $(method3).length >= 1 || $(method4).length >= 1 || $(method5).length >= 1 || $(method6).length >= 1 || $(method7).length >= 1 || $(method8).length >= 1 || $(method9).length >= 1
        }

        function IsPlayer2Win() {
            let method1 = "body .board .TicTacToe.player-2.c-3.checked ~ .TicTacToe.player-2.c-3.checked ~ .TicTacToe.player-2.c-3.checked"
            let method2 = "body .board .TicTacToe.player-2.r-3.checked ~ .TicTacToe.player-2.r-3.checked ~ .TicTacToe.player-2.r-3.checked"
            let method3 = "body .board .TicTacToe.player-2.d-3.checked ~ .TicTacToe.player-2.d-3.checked ~ .TicTacToe.player-2.d-3.checked"
            let method4 = "body .board .TicTacToe.player-2.c-2.checked ~ .TicTacToe.player-2.c-2.checked ~ .TicTacToe.player-2.c-2.checked"
            let method5 = "body .board .TicTacToe.player-2.r-2.checked ~ .TicTacToe.player-2.r-2.checked ~ .TicTacToe.player-2.r-2.checked"
            let method6 = "body .board .TicTacToe.player-2.d-2.checked ~ .TicTacToe.player-2.d-2.checked ~ .TicTacToe.player-2.d-2.checked"
            let method7 = "body .board .TicTacToe.player-2.c-1.checked ~ .TicTacToe.player-2.c-1.checked ~ .TicTacToe.player-2.c-1.checked"
            let method8 = "body .board .TicTacToe.player-2.r-1.checked ~ .TicTacToe.player-2.r-1.checked ~ .TicTacToe.player-2.r-1.checked"
            let method9 = "body .board .TicTacToe.player-2.d-1.checked ~ .TicTacToe.player-2.d-1.checked ~ .TicTacToe.player-2.d-1.checked"
            return $(method1).length >= 1 || $(method2).length >= 1 || $(method3).length >= 1 || $(method4).length >= 1 || $(method5).length >= 1 || $(method6).length >= 1 || $(method7).length >= 1 || $(method8).length >= 1 || $(method9).length >= 1
        }

        function IsATie() {
            let method = "body .board .TicTacToe.checked ~ .TicTacToe.checked ~ .TicTacToe.checked ~ .TicTacToe.checked ~ .TicTacToe.checked ~ .TicTacToe.checked ~ .TicTacToe.checked ~ .TicTacToe.checked ~ .TicTacToe.checked"
            return method && $(".overlay").css("display") == "grid"
        }

        function GetPlace(el) {
            return $(el).data('id');
        }

        function CheckPlaceByCode(player, place) {
            let code = place
            $("[data-id=" + code + "]").addClass("checked")
            if (!$(".board").hasClass("me-x") && player == "1") {
                $(".board").addClass("me-turn")
                $(".board").removeClass("me-NOT")
                if (IsPlayer1Win()) {
                    $.post('http://d7y_TicTacToe/win', JSON.stringify({ GameID: $(".board").data("game"), status: "x" }));
                } else if (IsPlayer2Win()) {
                    $.post('http://d7y_TicTacToe/win', JSON.stringify({ GameID: $(".board").data("game"), status: "o" }));
                } else if (IsATie()) {
                    $.post('http://d7y_TicTacToe/win', JSON.stringify({ GameID: $(".board").data("game"), status: "Tie" }));
                }
            } else if ($(".board").hasClass("me-x") && player == "2") {
                $(".board").addClass("me-turn")
                $(".board").removeClass("me-NOT")
                if (IsPlayer1Win()) {
                    $.post('http://d7y_TicTacToe/win', JSON.stringify({ GameID: $(".board").data("game"), status: "x" }));
                } else if (IsPlayer2Win()) {
                    $.post('http://d7y_TicTacToe/win', JSON.stringify({ GameID: $(".board").data("game"), status: "o" }));
                } else if (IsATie()) {
                    $.post('http://d7y_TicTacToe/win', JSON.stringify({ GameID: $(".board").data("game"), status: "Tie" }));
                }
            }
        }

    </script>
</body>

</html>